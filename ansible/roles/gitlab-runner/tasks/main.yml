---
# tasks file for gitlab-runner
- name: Create directory for compose gitlab-runner
  file:
    path: /opt/gitlab-runner
    state: directory

- name: Copy compose file to remote host
  template:
    src: docker-compose.yml.j2
    dest: /opt/gitlab-runner/docker-compose.yml

- name: Start Gitlab in Docker
  docker_service:
    project_name: gitlab-ci
    project_src: /opt/gitlab-runner

- name: Register gitlab-runner in gitlab-ci
  shell: docker exec gitlab-ci_gitlab-runner_1 gitlab-runner register --non-interactive --url "http://35.192.181.103/" --registration-token "xNTyeuAdGtSTFuWTgNpUkjr" --executor "docker" --docker-image alpine:latest --description "docker-runner-01" --tag-list "docker" --run-untagged="true" --locked="false" --docker-privileged
